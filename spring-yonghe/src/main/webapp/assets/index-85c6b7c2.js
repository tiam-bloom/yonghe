import{d as P,r as g,o as E,e as F,w as l,f as r,b as $,g as o,h as x,t as q,E as c,_ as K,i as U,j as R,c as W,k as H,l as J,u as S,F as L,m as Q,s as X,n as Y,p as Z,a as ee,q as oe}from"./index-6fb96e19.js";import{h as y}from"./http-dc82cd1a.js";const te={class:"dialog-footer"},le=P({__name:"DoorDialog",props:{title:null,door:null},emits:["getDoors"],setup(a,{expose:I,emit:v}){const h=a,i=g(!1);function p(){const s=q(h.door);h.title=="新增门店"?f(s):k(s),i.value=!1}function f(s){y.post("/door/insertDoor",s).then(t=>{t.data.code==200?(v("getDoors"),c.success("新增成功")):c.error("新增失败")})}function k(s){y.put("/door/updateDoor",s).then(t=>{t.data.code==200?(v("getDoors"),c.success("修改成功")):c.error("修改失败")})}function m(){i.value=!0}return I({showDialog:m}),(s,t)=>{const D=r("el-input"),V=r("el-form-item"),C=r("el-form"),B=r("el-button"),z=r("el-dialog");return E(),F(z,{modelValue:i.value,"onUpdate:modelValue":t[4]||(t[4]=u=>i.value=u),title:a.title,width:"600"},{footer:l(()=>[$("span",te,[o(B,{onClick:t[3]||(t[3]=u=>i.value=!1)},{default:l(()=>[x("返回")]),_:1}),o(B,{type:"primary",onClick:p},{default:l(()=>[x(" 确定 ")]),_:1})])]),default:l(()=>[o(C,{model:a.door},{default:l(()=>[o(V,{label:"店名","label-width":50},{default:l(()=>[o(D,{modelValue:a.door.name,"onUpdate:modelValue":t[0]||(t[0]=u=>a.door.name=u),autocomplete:"on",placeholder:"请输入店名"},null,8,["modelValue"])]),_:1}),o(V,{label:"电话","label-width":50},{default:l(()=>[o(D,{modelValue:a.door.tel,"onUpdate:modelValue":t[1]||(t[1]=u=>a.door.tel=u),autocomplete:"on",placeholder:"请输入电话"},null,8,["modelValue"])]),_:1}),o(V,{label:"地址","label-width":50},{default:l(()=>[o(D,{modelValue:a.door.addr,"onUpdate:modelValue":t[2]||(t[2]=u=>a.door.addr=u),autocomplete:"on",placeholder:"请输入地址"},null,8,["modelValue"])]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue","title"])}}});const ne=K(le,[["__scopeId","data-v-7cc7dd5b"]]),ae=a=>(Z("data-v-26a7425f"),a=a(),ee(),a),de=ae(()=>$("h1",null,"门店管理",-1)),re={class:"banner"},ie={class:"page"},se=P({__name:"index",setup(a){function I(){c.info("已取消删除")}const v=g(""),h=g(),i=U({currentPage:1,pageSize:15,total:0});let p=U({name:"",tel:"",addr:""});const f=g([]);R(()=>{m()});const k=g(!0);function m(n=1){i.currentPage=n,y.get("/door/pageDoors",{params:{currentPage:n,pageSize:i.pageSize}}).then(e=>{f.value=e.data.data.list,i.total=e.data.data.total}).catch(e=>{c.error("请检查接口"+e)}).finally(()=>{k.value=!1})}const s=g(""),t=g("");function D(n,e){v.value="修改门店",p.id=e.id,p.name=e.name,p.tel=e.tel,p.addr=e.addr,h.value.showDialog()}const V=(n,e)=>{oe.confirm("该门店下存在订单, 这将会删除其下所有订单,确定继续吗?","Warning",{confirmButtonText:"我确定",cancelButtonText:"取消",type:"warning"}).then(async()=>y.delete(`/order/deleteOrdersByDoorId/${e}`)).then(d=>{if(d.data.code!==200)return c.error("删除门店失败"),new Promise(()=>{})}).then(()=>{C(n,e)}).catch(()=>{c({type:"info",message:"取消操作"})})};function C(n,e){y.delete(`/door/deleteDoorById/${e}`).then(d=>{d.data.code===200?(f.value.splice(n,1),c.success("删除成功")):c.error("删除失败")})}function B(n,e){y.get(`/order/listOrdersByDoorId/${e.id}`).then(d=>{d.data.data.length>0?V(n,e.id):C(n,e.id)})}function z(){v.value="新增门店";for(const n in p)p[n]="";h.value.showDialog()}function u(){const n=s.value.trim(),e=t.value;if(!e){m();return}f.value=f.value.filter(d=>{if(n)return d[n].includes(e);for(const b in d)if(b!=="id"&&d[b].includes(e))return!0}),f.value.length===0&&(c.warning("没有找到相关门店"),m())}return(n,e)=>{const d=r("el-button"),b=r("el-option"),M=r("el-select"),N=r("el-input"),w=r("el-table-column"),T=r("el-popconfirm"),A=r("el-table"),G=r("el-pagination"),O=Q("loading");return E(),W(L,null,[de,$("div",re,[o(d,{type:"primary",onClick:z},{default:l(()=>[x("新增门店")]),_:1}),o(N,{modelValue:t.value,"onUpdate:modelValue":e[1]||(e[1]=_=>t.value=_),placeholder:"请输入关键词",class:"input-with-select",onKeyup:H(u,["enter","native"]),clearable:""},{prepend:l(()=>[o(M,{modelValue:s.value,"onUpdate:modelValue":e[0]||(e[0]=_=>s.value=_),placeholder:"筛选",style:{width:"80px"},name:"field"},{default:l(()=>[o(b,{label:"店名",value:"name"}),o(b,{label:"电话",value:"tel"}),o(b,{label:"地址",value:"addr"})]),_:1},8,["modelValue"])]),append:l(()=>[o(d,{icon:S(X),onClick:u},null,8,["icon"])]),_:1},8,["modelValue","onKeyup"])]),J((E(),F(A,{data:f.value,style:{width:"100%"},stripe:"",height:"660"},{default:l(()=>[o(w,{type:"index"}),o(w,{prop:"name",label:"店名",width:"300"}),o(w,{prop:"tel",label:"电话",width:"200"}),o(w,{prop:"addr",label:"地址"}),o(w,{label:"操作",width:"200"},{default:l(_=>[o(d,{size:"small",onClick:j=>D(_.$index,_.row)},{default:l(()=>[x("修改")]),_:2},1032,["onClick"]),o(T,{width:"220","confirm-button-text":"废话","cancel-button-text":"点错了",icon:S(Y),"icon-color":"#626AEF",title:"你确定要删除吗?",onConfirm:j=>B(_.$index,_.row),onCancel:I},{reference:l(()=>[o(d,{size:"small",type:"danger"},{default:l(()=>[x("删除")]),_:1})]),_:2},1032,["icon","onConfirm","onCancel"])]),_:1})]),_:1},8,["data"])),[[O,k.value]]),$("div",ie,[o(G,{background:"",layout:"prev, pager, next",total:i.total,"current-page":i.currentPage,"page-size":i.pageSize,onCurrentChange:m},null,8,["total","current-page","page-size"])]),o(ne,{ref_key:"dialog",ref:h,title:v.value,door:S(p),onGetDoors:m},null,8,["title","door","onGetDoors"])],64)}}});const pe=K(se,[["__scopeId","data-v-26a7425f"]]);export{pe as default};
